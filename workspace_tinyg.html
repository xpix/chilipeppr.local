<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">

    <title>Workspace / TinyG</title>

    <!-- ChiliPeppr is based on bootstrap CSS. -->
    <link rel="stylesheet" type="text/css" href="jslib/bootstrap/dist/css/bootstrap.min.css">

    <!-- Customized version of require.js for ChiliPeppr. Please see require.js docs for how
    ChiliPeppr's dependency system works as it's based on require.js. -->
    <script type='text/javascript' src="jslib/cplibs/require.js"></script>

    <style type='text/css'>
.workspace-dropdown li {
    padding: 6px 20px;
}
.btn-ws {
    width:100%;
    /*margin:6px 20px;*/
}
.zipwhip-button {
    /*line-height:0px;*/
    /*padding: 1px 2px;*/
}
.zipwhip-recvtext-button {
    /*height:22px;*/
}
.zipwhip {
    background: url('http://www.zipwhip.com/resources/images/favicon.ico') no-repeat top left;
    display: inline-block;
    /*margin: 1px 0;*/
    margin: -4px 5px;
    height: 16px;
    width: 16px;
    /* line-height:0px; */
    background-size: 16px 16px;
    /* -webkit-background-size: 50% 50%; Safari
    -khtml-background-size: 50% 50%; Konqueror
    -moz-background-size: 50% 50%; Firefox */
}
#com-chilipeppr-ws-gcode-wrapper .dropdown-menu {
    /* z-index:6; */
    /* position:inherit; */
}
#com-chilipeppr-ws-gcode-wrapper .panel-heading {
    /* padding: 10px 12px; */
}
#com-chilipeppr-ws-gcode-wrapper .well.com-chilipeppr-ws-hdr {
    /* padding: 10px 15px; */
}
#com-chilipeppr-ws-gcode-dragdrop {
    /*margin-right:6px;*/
}
#com-chilipeppr-ws-gcode-hdr {
    height:64px;
    margin-bottom:10px;
}
.panel {
    margin-bottom:10px;
}
#com-chilipeppr-ws-gcode-wrapper #com-chilipeppr-widget-gcode-body {
    /* max-height:250px; */
    height:250px;
}
#com-chilipeppr-ws-gcode-wrapper .com-chilipeppr-widget-spconsole {
    margin-bottom:0;
}
#com-chilipeppr-ws-gcode-dragdropoverlay {
    position: absolute;
    top:0;
    bottom:0;
    left:0;
    right:0;
    z-index:10;
    background-color: rgba(255, 255, 255, 0.5);
    font-size: 20px;
    padding:100px;
    border: 3px dashed #3276b1;
    text-align:center;
    pointer-events: none;
}
#com-chilipeppr-ws-gcode-dragdropoverlay .well {
    background-color: rgba(127, 127, 127, 0.5);
}
#com-chilipeppr-ws-gcode-wrapper.hover {
    /* background-color: blue; */
}
.com-chilipeppr-elem-dragdrop {
    /* border: 1px dashed gray; */
    /* border-radius: 4px; */
    padding:0;
    margin-right:6px;
}
.padrt {
    padding-right:10px;
    padding-left:10px;
}
.zhigh {
    /* z-index:5; */
    position:relative;
}
#com-chilipeppr-ws-gcode-wrapper .dropdown-menu {
    /* z-index:20; */
}
#mainnav {
    z-index:5;
}
.nopadding {
    padding:0;
}
#com-chilipeppr-widget-3dviewer .panel-heading, #com-chilipeppr-3dviewer-controlpanel .panel-heading {
    background:none;
    /* border:none; */
    padding:10px 15px;
    margin-bottom:0;
}
#com-chilipeppr-3dviewer-controlpanel {
    padding:0 10px;
    float:left;
}
#com-chilipeppr-gcode-list {
    /* padding-right: 10px; */
    /* z-index:5; */
    /* position: relative; */
}
#com-chilipeppr-serialport-ws-hdr {
    /* z-index:5; */
}
.well.com-chilipeppr-ws-hdr {
    padding:10px 15px;
    /* padding:8px; */
    /* padding-left:15px; */
    /* margin:0; */
    /* margin-bottom:10px; */
}
#chilipeppr-3dviewer {
    /* z-index: -1; */
    padding-right:10px;
}
#com-chilipeppr-widget-3dviewer-renderArea {
    /* z-index:0; */
}
.row .widget {
    margin:0;
    padding:0;
}
.dropArea.hover {
    background: #dddddd;
}
#pnlWorkspace.hover {
    background: red;
}
body.hover {
    background: #5bc0de;
}
#chilipeppr-serialport-wrapper .com-chilipeppr-widget-serialport-spselector {
    max-height: none;
}
#chilipeppr-serialport-log {
    /*height:200px;*/
    /* padding-right:10px; */
    /* z-index:5; */
    /* position: relative; */
}
.nomargin {
    margin:0;
}
.noheight {
    height:0;
}

.billboard-content {
    padding: 6px 20px;
}
.billboard-title {
    margin-bottom:6px;
}
.billboard-url {
    /* font-size: 9px; */
    padding-top:0px;
    margin-bottom:6px;
    font-size:12px;
}
.billboard-img {
    border:0px solid red;
    border-radius: 5px;
    position: relative;
    width:100%;
    height:160px;
    background-position: center;
    background-size: cover;
}
.billboard-imgcontain {
    border:0px solid red; 
    position: relative;
}
.billboard-stats {
    position: absolute;
    top: 4px;
    left: 10px;
}
.billboard-desc {
    /* font-size:11px; */
}
.billboard-detail-title {
    font-weight: bold;
}
.billboard-stats2 {
    position: absolute;
    bottom: 0px;
    left: 0px;
    right: 0px;
    padding: 4px 10px 10px 10px;
    background-color: rgba(255, 255, 255, 0.5);
}

    </style>

    <script type='text/javascript'>
    //<![CDATA[
/* global cpdefine chilipeppr cprequire */

// ----------- chilipeppr.local changes ----------
// Now we are in "test" - mode. Means this is the main method for cp.local
cprequire_test(["inline:com-chilipeppr-workspace-tinyg"], function(ws) {

    console.log("initting workspace");

    /**
     * The Root workspace (when you see the ChiliPeppr Header) auto Loads the Flash 
     * Widget so we can show the 3 second flash messages. However, in test mode we
     * like to see them as well, so just load it from the cprequire_test() method
     * so we have similar functionality when testing this workspace.
     */
    var loadFlashMsg = function() {
        chilipeppr.load("#com-chilipeppr-widget-flash-instance",
            "http://fiddle.jshell.net/chilipeppr/90698kax/show/light/", // TODO: Github submodule, build a github repository
            function() {
                console.log("mycallback got called after loading flash msg module");
                cprequire(["inline:com-chilipeppr-elem-flashmsg"], function(fm) {
                    //console.log("inside require of " + fm.id);
                    fm.init();
                });
            }
        );
    };
    loadFlashMsg();

    // Init workspace
    ws.init();

    // Do some niceties for testing like margins on widget and title for browser
    $('title').html("Tinyg LOCAL Workspace");
    $('body').css('padding', '10px');

} /*end_test*/ );

// This is the main definition of your widget. Give it a unique name.
cpdefine("inline:com-chilipeppr-workspace-tinyg", ["chilipeppr_ready"], function() {
    return {
        /**
         * The ID of the widget. You must define this and make it unique.
         */
        id: "com-chilipeppr-workspace-tinyg", // Make the id the same as the cpdefine id
        name: "Workspace / TinyG", // The descriptive name of your widget.
        desc: `This is a workspace for ChiliPeppr's Hardware Fiddle. It is geared towards CNC machines using TinyG.`,
        url: "http://raw.githubusercontent.com/chilipeppr/workspace-tinyg/master/auto-generated-workspace.html", // The final URL of the working widget as a single HTML file with CSS and Javascript inlined. You can let runme.js auto fill this if you are using Cloud9.
        fiddleurl: "http://ide.c9.io/chilipeppr/workspace-tinyg", // The edit URL. This can be auto-filled by runme.js in Cloud9 if you'd like, or just define it on your own to help people know where they can edit/fork your widget
        githuburl: "http://github.com/chilipeppr/workspace-tinyg", // The backing github repo
        testurl: "http://workspace-tinyg-chilipeppr.c9users.io/workspace.html", // The standalone working widget so can view it working by itself

        foreignSubscribe: {
            "/com-chilipeppr-elem-dragdrop/ondragover": "The Chilipeppr drag drop element will publish on channel /com-chilipeppr-elem-dragdrop/ondropped when a file is dropped so we subscribe to it so we can load a Gcode file when the user drags it onto the browser. It also adds a hover class to the bound DOM elem so we can add a CSS to hilite on hover",
            "/com-chilipeppr-elem-dragdrop/ondragleave": "We need to know when the drag is over to remove the CSS hilites.",
            "/com-chilipeppr-widget-gcode/resize": "We watch if the Gcode viewer resizes so that we can reposition or resize other elements in the workspace. Specifically we ask the Serial Port Console to resize. We also redraw the 3D Viewer so it fills the whole screen."
        },

        foreignPublish: {},

        /**
         * Contains reference to the Console widget object. Hang onto the reference
         * so we can resize it when the window resizes because we want it to manually
         * resize to fill the height of the browser so it looks clean.
         */
        widgetConsole: null,
        /**
         * Contains reference to the Serial Port JSON Server object.
         */
        widgetSpjs: null,
        /**
         * The workspace's init method. It loads the all the widgets contained in the workspace
         * and inits them.
         */
        init: function() {

            // Most workspaces will instantiate the Serial Port JSON Server widget
            this.loadSpjsWidget();
            
            // Most workspaces will instantiate the Serial Port Console widget
            this.loadConsoleWidget();
            
            // This is a huge method that was built from the original jsfiddle workspace
            // we should technically put each widget in its own method for loading
            this.loadWidgets();

            // Create our workspace upper right corner triangle menu
            this.loadWorkspaceMenu();
            
            // Add our billboard to the menu (has name, url, picture of workspace)
            this.addBillboardToWorkspaceMenu();

            // Setup an event to react to window resize. This helps since
            // some of our widgets have a manual resize to cleanly fill
            // the height of the browser window. You could turn this off and
            // just set widget min-height in CSS instead
            this.setupResize();
            
            setTimeout(function() {
                $(window).trigger('resize');
            }, 3000);


        },
        /**
         * Returns the billboard HTML, CSS, and Javascript for this Workspace. The billboard
         * is used by the home page, the workspace picker, and the fork pulldown to show a
         * consistent name/image/description tag for the workspace throughout the ChiliPeppr ecosystem.
         */
        getBillboard: function() {
            var el = $('#' + this.id + '-billboard').clone();
            el.removeClass("hidden");
            el.find('.billboard-desc').text(this.desc);
            return el;
        },
        /**
         * Inject the billboard into the Workspace upper right corner pulldown which
         * follows the standard template for workspace pulldown menus.
         */
        addBillboardToWorkspaceMenu: function() {
            // get copy of billboard
            var billboardEl = this.getBillboard();
            $('#' + this.id + ' .com-chilipeppr-ws-billboard').append(billboardEl);
        },
        /**
         * Listen to window resize event.
         */
        setupResize: function() {
            $(window).on('resize', this.onResize.bind(this));
        },
        /**
         * When browser window resizes, forcibly resize the Console window
         */
        onResize: function() {
            if (this.widgetConsole) this.widgetConsole.resize();
        },
        /**
         * Load the Serial Port JSON Server widget via chilipeppr.load()
         */
        loadSpjsWidget: function(callback) {

            var that = this;

            chilipeppr.load(
                "#com-chilipeppr-widget-spjs-instance",
                "widgets/widget-spjs/auto-generated-widget.html",
                function() {
                    console.log("mycallback got called after loading spjs module");
                    cprequire(["inline:com-chilipeppr-widget-serialport"], function(spjs) {
                        //console.log("inside require of " + fm.id);
                        spjs.setSingleSelectMode();
                        spjs.init({
                            isSingleSelectMode: true,
                            defaultBuffer: "tinyg",
                            defaultBaud: 115200,
                            bufferEncouragementMsg: 'For your device please choose the "tinyg" or "tinygg2" buffer in the pulldown and a 115200 baud rate before connecting.'
                        });
                        //spjs.showBody();
                        //spjs.consoleToggle();

                        that.widgetSpjs - spjs;

                        if (callback) callback(spjs);

                    });
                }
            );
        },
        /**
         * Load the Console widget via chilipeppr.load()
         */
        loadConsoleWidget: function(callback) {
            var that = this;
            chilipeppr.load(
                "#com-chilipeppr-widget-console-instance",
                "widgets/widget-console/auto-generated-widget.html",
                function() {
                    // Callback after widget loaded into #com-chilipeppr-widget-spconsole-instance
                    cprequire(
                        ["inline:com-chilipeppr-widget-spconsole"], // the id you gave your widget
                        function(mywidget) {
                            // Callback that is passed reference to your newly loaded widget
                            console.log("My Console widget just got loaded.", mywidget);
                            that.widgetConsole = mywidget;

                            // init the serial port console
                            // 1st param tells the console to use "single port mode" which
                            // means it will only show data for the green selected serial port
                            // rather than for multiple serial ports
                            // 2nd param is a regexp filter where the console will filter out
                            // annoying messages you don't generally want to see back from your
                            // device, but that the user can toggle on/off with the funnel icon
                            that.widgetConsole.init(true, /^{/);
                            if (callback) callback(mywidget);
                        }
                    );
                }
            );
        },
        /**
         * Load the workspace menu and show the pubsubviewer and fork links using
         * our pubsubviewer widget that makes those links for us.
         */
        loadWorkspaceMenu: function(callback) {
            // Workspace Menu with Workspace Billboard
            var that = this;
            chilipeppr.load(
                "widgets/widget-pubsubviewer/auto-generated-widget.html",
                function() {
                    require(['inline:com-chilipeppr-elem-pubsubviewer'], function(pubsubviewer) {

                        var el = $('#' + that.id + ' #com-chilipeppr-ws-menu .dropdown-menu-ws');
                        console.log("got callback for attachto menu for workspace. attaching to el:", el);

                        pubsubviewer.attachTo(
                            el,
                            that,
                            "Workspace"
                        );

                        if (callback) callback();
                    });
                }
            );
        },


        loadWidgets: function(callback) {
            
            // create a workspace object reference to this so inside the anonymous functions below
            // the workspace can be referred to
            var wsObj = this;

            this.font2gcodeObj = function() {
                return {
                    name: "font2gcode",
                    url: "widgets/widget-font2gcode/auto-generated-widget.html",
                    id: "com-zipwhip-widget-font2gcode",
                    btn: $('#com-chilipeppr-ws-menu .font2gcode-button'),
                    div: $('#com-chilipeppr-ws-font2gcode'),
                    instance: null,
                    init: function() {
                        this.btn.click(this.toggle.bind(this));
                        
                        // do NOT dynamically load this one since it has a pubsub that's key to get called
                        // and in future may register for drag/drop events for .txt files  
                        this.load();
                        
                        // we need to subscribe to the /didDrop signal of this widget so we know to show it
                        //chilipeppr.subscribe("/" + this.id + "/didDrop", this, this.show);
                        console.log("done instantiating " + this.name + " add-on widget");
                    },
                    load: function(callback) {
                        var that = this;
                        chilipeppr.load(
                          this.div.prop("id"),
                          this.url,
                          function() {
                            // Callback after widget loaded into #myDivWidgetRecvtext
                            // Now use require.js to get reference to instantiated widget
                            cprequire(
                              ["inline:" + that.id], // the id you gave your widget
                              function(myObjWidget) {
                                // Callback that is passed reference to the newly loaded widget
                                console.log(that.name + " just got loaded.", myObjWidget);
                                //myObjWidget.init(myObjWidget.activate.bind(myObjWidget));
                                myObjWidget.init();
                                //myObjWidget.activate();
                                that.instance = myObjWidget;
                                if (callback) callback(that.instance);
                              }
                            );
                          }
                        );
                    },
                    toggle: function() {
                        if (this.div.hasClass("hidden")) {
                            // unhide
                            this.show();
                        }
                        else {
                            this.hide();
                        }
                    },
                    show: function() {
                        this.div.removeClass("hidden");
                        this.btn.addClass("active");
    
                        console.log("got show for " + this.name + ", this:", this, "wsObj:", wsObj);
                        
                        // see if instantiated already
                        // if so, just activate
                        if (this.instance != null) {
                            console.log("activating " + this.name + " instead of re-instantiating cuz already created");
                            this.instance.activate();
                            //if (callback) callback(this.instance);
                        }
                        else {
                            // otherwise, dynamic load
                            console.log(this.name + " appears to not be instantiated, let us load it from scratch")
                            
                        }
                        $(window).trigger('resize');
                    },
                    hide: function() {
                        this.div.addClass("hidden");
                        this.btn.removeClass("active");
                        
                        console.log("got hide for " + this.name + ". this:", this, "wsObj:", wsObj);
                        
                        if (this.instance != null) {
                            this.instance.unactivate();
                        }
                        $(window).trigger('resize');
                    }
                };
            }();
            this.font2gcodeObj.init();
            //End Font2Gcode

            this.svg2gcodeObj = function() {
                return {
                    name: "svg2gcode",
                    url: "widgets/widget-svg2gcode/auto-generated-widget.html",
                    id: "com-zipwhip-widget-svg2gcode",
                    btn: $('#com-chilipeppr-ws-menu .svg2gcode-button'),
                    div: $('#com-chilipeppr-ws-svg2gcode'),
                    instance: null,
                    init: function() {
                        this.btn.click(this.toggle.bind(this));
                        
                        // do NOT dynamically load this one since it registers for drag/drop events for .svg files  
                        this.load();
                        
                        // we need to subscribe to the /didDrop signal of this widget so we know to show it
                        chilipeppr.subscribe("/" + this.id + "/didDrop", this, this.show);
                        console.log("done instantiating " + this.name + " add-on widget");
                    },
                    load: function(callback) {
                        var that = this;
                        chilipeppr.load(
                          this.div.prop("id"),
                          this.url,
                          function() {
                            // Callback after widget loaded into #myDivWidgetRecvtext
                            // Now use require.js to get reference to instantiated widget
                            cprequire(
                              ["inline:" + that.id], // the id you gave your widget
                              function(myObjWidget) {
                                // Callback that is passed reference to the newly loaded widget
                                console.log(that.name + " just got loaded.", myObjWidget);
                                //myObjWidget.init(myObjWidget.activate.bind(myObjWidget));
                                myObjWidget.init();
                                //myObjWidget.activate();
                                that.instance = myObjWidget;
                                if (callback) callback(that.instance);
                              }
                            );
                          }
                        );
                    },
                    toggle: function() {
                        if (this.div.hasClass("hidden")) {
                            // unhide
                            this.show();
                        }
                        else {
                            this.hide();
                        }
                    },
                    show: function() {
                        this.div.removeClass("hidden");
                        this.btn.addClass("active");
    
                        console.log("got show for " + this.name + ", this:", this, "wsObj:", wsObj);
                        
                        // see if instantiated already
                        // if so, just activate
                        if (this.instance != null) {
                            console.log("activating " + this.name + " instead of re-instantiating cuz already created");
                            this.instance.activate();
                            //if (callback) callback(this.instance);
                        }
                        else {
                            // otherwise, dynamic load
                            console.log(this.name + " appears to not be instantiated, let us load it from scratch")
                            
                        }
                        $(window).trigger('resize');
                    },
                    hide: function() {
                        this.div.addClass("hidden");
                        this.btn.removeClass("active");
                        
                        console.log("got hide for " + this.name + ". this:", this, "wsObj:", wsObj);
                        
                        if (this.instance != null) {
                            this.instance.unactivate();
                        }
                        $(window).trigger('resize');
                    }
                };
            }();
            this.svg2gcodeObj.init();
            //End SVG2Gcode

            // Zipwhip texting
            // com-chilipeppr-ws-zipwhip
            chilipeppr.load(
                "#com-chilipeppr-ws-zipwhip",
                "widgets/widget-zipwhip/auto-generated-widget.html",
                function() {
                    require(["inline:com-chilipeppr-elem-zipwhip"], function(zipwhip) {
                        zipwhip.init();
                        // setup toggle button
                        var zwBtn = $('#com-chilipeppr-ws-menu .zipwhip-button');
                        var zwDiv = $('#com-chilipeppr-ws-zipwhip');
                        zwBtn.click(function() {
                            if (zwDiv.hasClass("hidden")) {
                                // unhide
                                zwDiv.removeClass("hidden");
                                zwBtn.addClass("active");
                            }
                            else {
                                zwDiv.addClass("hidden");
                                zwBtn.removeClass("active");
                            }
                            $(window).trigger('resize');
                        });
                    });
                }); //End Zipwhip texting


            // Zipwhip Recieve Text widget
            // Dynamically load the Zipwhip Recieve Text widget, i.e. wait til user clicks on the button
            // first time.
            wsObj.zipwhipRecvTextObj = {
                zipwhipRecvTextBtn: null,
                zipwhipRecvTextDiv: null,
                zipwhipRecvTextInstance: null,
                init: function() {
                    this.zipwhipRecvTextBtn = $('#com-chilipeppr-ws-menu .zipwhip-recvtext-button');
                    this.zipwhipRecvTextDiv = $('#com-chilipeppr-ws-zipwhip-recvtext');
                    this.setupBtn();
                    console.log("done instantiating zipwhipRecvText add-on widget");
                },
                setupBtn: function() {
                    this.zipwhipRecvTextBtn.click(this.togglezipwhipRecvText.bind(this));
                },
                togglezipwhipRecvText: function() {
                    if (this.zipwhipRecvTextDiv.hasClass("hidden")) {
                        // unhide
                        this.showzipwhipRecvText();
                    }
                    else {
                        this.hidezipwhipRecvText();
                    }
                },
                showzipwhipRecvText: function(callback) {
                    this.zipwhipRecvTextDiv.removeClass("hidden");
                    this.zipwhipRecvTextBtn.addClass("active");

                    console.log("got showzipwhipRecvText. this:", this, "wsObj:", wsObj);
                    
                    // see if instantiated already
                    // if so, just activate
                    if (this.zipwhipRecvTextInstance != null) {
                        console.log("activating zipwhip recv text instead of re-instantiating cuz already created")
                        this.zipwhipRecvTextInstance.activateWidget();
                        if (callback) callback(this.zipwhipRecvTextInstance);
                    }
                    else {
                        // otherwise, dynamic load
                        console.log("zipwhip recv text appears to not be instantiated, let us load it from scratch")
                        var that = this;
                        chilipeppr.load(
                          this.zipwhipRecvTextDiv.prop("id"),
                          "widgets/widget-recvtext/auto-generated-widget.html",
                          function() {
                            // Callback after widget loaded into #myDivWidgetRecvtext
                            // Now use require.js to get reference to instantiated widget
                            cprequire(
                              ["inline:com-chilipeppr-widget-recvtext"], // the id you gave your widget
                              function(myObjWidgetRecvtext) {
                                // Callback that is passed reference to the newly loaded widget
                                console.log("Widget / Zipwhip Receive Text just got loaded.", myObjWidgetRecvtext);
                                myObjWidgetRecvtext.init();
                                that.zipwhipRecvTextInstance = myObjWidgetRecvtext;
                                if (callback) callback(that.zipwhipRecvTextInstance);
                              }
                            );
                          }
                        );
                    }
                    $(window).trigger('resize');
                },
                hidezipwhipRecvText: function() {
                    this.zipwhipRecvTextDiv.addClass("hidden");
                    this.zipwhipRecvTextBtn.removeClass("active");
                    
                    console.log("got hidezipwhipRecvText. this:", this, "wsObj:", wsObj);
                    
                    if (this.zipwhipRecvTextInstance != null) {
                        this.zipwhipRecvTextInstance.unactivateWidget();
                    }
                    $(window).trigger('resize');
                },
            };
            wsObj.zipwhipRecvTextObj.init();
            //End Zipwhip Receive Text
            
            // Auto-Leveller
            // com-chilipeppr-ws-autolevel
            chilipeppr.load(
                "#com-chilipeppr-ws-autolevel",
                "widgets/widget-autolevel/auto-generated-widget.html",
                function() {
                    require(["inline:com-chilipeppr-widget-autolevel"], function(autolevel) {
                        autolevel.init();
                        // setup toggle button
                        var alBtn = $('#com-chilipeppr-ws-menu .autolevel-button');
                        var alDiv = $('#com-chilipeppr-ws-autolevel');
                        alBtn.click(function() {
                            if (alDiv.hasClass("hidden")) {
                                // unhide
                                alDiv.removeClass("hidden");
                                alBtn.addClass("active");
                                autolevel.onDisplay();
                            }
                            else {
                                alDiv.addClass("hidden");
                                alBtn.removeClass("active");
                                autolevel.onUndisplay();
                            }
                            $(window).trigger('resize');

                        });
                    });
                }); //End Auto-Leveller


            // Macro
            // com-chilipeppr-ws-macro
            chilipeppr.load(
                "#com-chilipeppr-ws-macro",
                "widgets/widget-macro/auto-generated-widget.html",
                function() {
                    //"http://fiddle.jshell.net/chilipeppr/ZJ5vV/show/light/", function () {
                    cprequire(["inline:com-chilipeppr-widget-macro"], function(macro) {
                        macro.init();
                        // setup toggle button
                        var alBtn = $('#com-chilipeppr-ws-menu .macro-button');
                        var alDiv = $('#com-chilipeppr-ws-macro');
                        alBtn.click(function() {
                            if (alDiv.hasClass("hidden")) {
                                // unhide
                                alDiv.removeClass("hidden");
                                alBtn.addClass("active");
                                //autolevel.onDisplay();
                            }
                            else {
                                alDiv.addClass("hidden");
                                alBtn.removeClass("active");
                                //autolevel.onUndisplay();
                            }
                            $(window).trigger('resize');

                        });
                    });
                }); //End Macro

            // JScut
            // com-chilipeppr-ws-jscut
            chilipeppr.load(
                "#com-chilipeppr-ws-jscut",
                "widgets/widget-jscut/auto-generated-widget.html",
                function() {
                    require(["inline:org-jscut-gcode-widget"], function(jscut) {
                        jscut.init();
                        // setup toggle button
                        var alBtn = $('#com-chilipeppr-ws-menu .jscut-button');
                        var alDiv = $('#com-chilipeppr-ws-jscut');
                        alBtn.click(function() {
                            if (alDiv.hasClass("hidden")) {
                                // unhide
                                alDiv.removeClass("hidden");
                                alBtn.addClass("active");
                            }
                            else {
                                alDiv.addClass("hidden");
                                alBtn.removeClass("active");
                            }
                            $(window).trigger('resize');

                        });
                    });
                }); //End JSCut

            // Eagle BRD Import
            // com-chilipeppr-widget-eagle

            // Setup drag/drop for BRD files on our own because we don't
            // want to instantiate the Eagle BRD codebase (i.e. load its massive
            // javascript files) until the user try requests that we do
            this.eagleObj = function() { 
                return {
                    eagleBtn: null,
                    eagleDiv: null,
                    eagleInstance: null,
                    init: function() {
                        this.eagleBtn = $('#com-chilipeppr-ws-menu .eagle-button');
                        this.eagleDiv = $('#com-chilipeppr-ws-eagle');
                        this.setupDragDrop();
                        this.setupBtn();
                        console.log("done instantiating micro Eagle BRD plug-in");
                    },
                    setupBtn: function() {
                        this.eagleBtn.click(this.toggleEagle.bind(this));
                    },
                    toggleEagle: function() {
                        if (this.eagleDiv.hasClass("hidden")) {
                            // unhide
                            this.showEagle();
                        }
                        else {
                            this.hideEagle();
                        }
                    },
                    showEagle: function(callback) {
                        this.eagleDiv.removeClass("hidden");
                        this.eagleBtn.addClass("active");
    
                        // see if instantiated already
                        // if so, just activate
                        if (this.eagleInstance != null) {
                            this.eagleInstance.activateWidget();
                            if (callback) callback();
                        }
                        else {
                            // otherwise, dynamic load
                            var that = this;
                            chilipeppr.load(
                                "#com-chilipeppr-ws-eagle",
                                "widgets/widget-eagle/auto-generated-widget.html",
                                function() {
                                    require(["inline:com-chilipeppr-widget-eagle"], function(eagle) {
                                        that.eagleInstance = eagle;
                                        console.log("Eagle BRD instantiated. eagleInstance:", that.eagleInstance);
                                        that.eagleInstance.init();
                                        //eagleInstance.activateWidget();
                                        if (callback) callback();
                                    });
                                }
                            );
                        }
                        $(window).trigger('resize');
                    },
                    hideEagle: function() {
                        this.eagleDiv.addClass("hidden");
                        this.eagleBtn.removeClass("active");
                        if (this.eagleInstance != null) {
                            this.eagleInstance.unactivateWidget();
                        }
                        $(window).trigger('resize');
                    },
                    setupDragDrop: function() {
                        // subscribe to events
                        chilipeppr.subscribe("/com-chilipeppr-elem-dragdrop/ondragover", this, this.onDragOver);
                        chilipeppr.subscribe("/com-chilipeppr-elem-dragdrop/ondragleave", this, this.onDragLeave);
                        // /com-chilipeppr-elem-dragdrop/ondropped
                        chilipeppr.subscribe("/com-chilipeppr-elem-dragdrop/ondropped", this, this.onDropped, 9); // default is 10, we do 9 to be higher priority
                    },
                    onDropped: function(data, info) {
                        console.log("onDropped. len of file:", data.length, "info:", info);
                        // we have the data
                        // double check it's a board file, cuz it could be gcode
                        if (data.match(/<!DOCTYPE eagle SYSTEM "eagle.dtd">/i)) {
    
                            // check that there's a board tag
                            if (data.match(/<board>/i)) {
                                console.log("we have an eagle board file!");
                                this.fileInfo = info;
                                var that = this;
                                this.showEagle(function() {
                                    console.log("got callback after showing eagle. now opening file.");
                                    that.eagleInstance.open(data, info);
                                });
                                console.log("opened brd file");
    
                                // do NOT store a lastDropped, rather we should
                                // get told from the workspace what the last file
                                // was and if it was a BRD file we should auto-open
                                /*
                                localStorage.setItem('com-chilipeppr-widget-eagle-lastDropped', data);
                                localStorage.setItem('com-chilipeppr-widget-eagle-lastDropped-info', JSON.stringify(info));
                                console.log("saved brd file to localstorage");
                                */
                            }
                            else {
                                console.log("looks like it is an eagle generated file, but not a board file. sad.");
                                chilipeppr.publish('/com-chilipeppr-elem-flashmsg/flashmsg', "Looks like you dragged in an Eagle CAD file, but it contains no board tag. You may have dragged in a schematic instead. Please retry with a valid board file.");
                            }
    
                            // now, we need to return false so no other widgets see this
                            // drag/drop event because they won't know how to handle
                            // an Eagle Brd file
                            return false;
                        }
                        else {
                            if (info && 'name' in info && info.name.match(/.brd$/i)) {
                                // this looks like an Eagle brd file, but it's binary
                                chilipeppr.publish('/com-chilipeppr-elem-flashmsg/flashmsg', "Error Loading Eagle BRD File", "Looks like you dragged in an Eagle BRD file, but it seems to be in binary. You can open this file in Eagle and then re-save it to a new file to create a text version of your Eagle BRD file.", 15 * 1000);
                                return false;
                            }
                            else {
                                console.log("we do not have an eagle board file. sad.");
                            }
                        }
                    },
                    onDragOver: function() {
                        console.log("onDragOver");
                        $('#com-chilipeppr-widget-eagle').addClass("panel-primary");
                        $('#com-chilipeppr-ws-menu .eagle-button').addClass("btn-primary");
                    },
                    onDragLeave: function() {
                        console.log("onDragLeave");
                        $('#com-chilipeppr-widget-eagle').removeClass("panel-primary");
                        $('#com-chilipeppr-ws-menu .eagle-button').removeClass("btn-primary");
                    },
                }; 
                
            }();
            console.log("eagleObj:", this.eagleObj);
            this.eagleObj.init();
            //End Eagle Brd Import

            // GPIO
            // net-delarre-widget-gpio

            // Dynamically load the GPIO widget, i.e. wait til user clicks on the button
            // first time.
            this.gpioObj = {
                gpioBtn: null,
                gpioDiv: null,
                gpioInstance: null,
                init: function() {
                    this.gpioBtn = $('#com-chilipeppr-ws-menu .gpio-button');
                    this.gpioDiv = $('#com-chilipeppr-ws-gpio');
                    this.setupBtn();
                    console.log("done instantiating GPIO add-on widget");
                },
                setupBtn: function() {
                    this.gpioBtn.click(this.toggleGpio.bind(this));
                },
                toggleGpio: function() {
                    if (this.gpioDiv.hasClass("hidden")) {
                        // unhide
                        this.showGpio();
                    }
                    else {
                        this.hideGpio();
                    }
                },
                showGpio: function(callback) {
                    this.gpioDiv.removeClass("hidden");
                    this.gpioBtn.addClass("active");

                    // see if instantiated already
                    // if so, just activate
                    if (this.gpioInstance != null) {
                        //this.gpioInstance.activateWidget();
                        if (callback) callback();
                    }
                    else {
                        // otherwise, dynamic load
                        var that = this;
                        chilipeppr.load(
                            "#com-chilipeppr-ws-gpio",
                            "widgets/widget-gpio/auto-generated-widget.html",
                            function() {
                                require(["inline:net-delarre-widget-gpio"], function(gpio) {
                                    that.gpioInstance = gpio;
                                    console.log("GPIO instantiated. gpioInstance:", that.gpioInstance);
                                    that.gpioInstance.init();
                                    //eagleInstance.activateWidget();
                                    if (callback) callback();
                                });
                            }
                        );
                    }
                    $(window).trigger('resize');
                },
                hideGpio: function() {
                    this.gpioDiv.addClass("hidden");
                    this.gpioBtn.removeClass("active");
                    if (this.gpioInstance != null) {
                        //this.gpioInstance.unactivateWidget();
                    }
                    $(window).trigger('resize');
                },
            };
            this.gpioObj.init();
            //End GPIO

            // SuttleXpress
            // Dynamically load the ShuttleXpress Widget. i.e. wait til user clicks on 
            // the button first time.
            // uses generic object so can cut/paste easier for others (or create actual object)
            // lordmundi/btyfqk7w
            this.shuttlexpressObj = function() {
                return {
                id: "shuttlexpress",
                url: "widgets/widget-shuttlexpress/auto-generated-widget.html",
                requireName: "inline:com-chilipeppr-widget-shuttlexpress",
                btn: null,
                div: null,
                instance: null,
                init: function() {
                    this.btn = $('#com-chilipeppr-ws-menu .' + this.id + '-button');
                    this.div = $('#com-chilipeppr-ws-' + this.id + '');
                    this.setupBtn();
                    console.log('done instantiating ' + this.id + ' add-on widget');
                },
                setupBtn: function() {
                    this.btn.click(this.toggle.bind(this));
                },
                toggle: function() {
                    if (this.div.hasClass("hidden")) {
                        // unhide
                        this.show();
                    }
                    else {
                        this.hide();
                    }
                },
                show: function(callback) {
                    this.div.removeClass("hidden");
                    this.btn.addClass("active");

                    // see if instantiated already
                    // if so, just activate
                    if (this.instance != null) {
                        this.instance.activateWidget();
                        if (callback) callback();
                    }
                    else {
                        // otherwise, dynamic load
                        var that = this;
                        chilipeppr.load(
                            '#com-chilipeppr-ws-' + this.id + '',
                            this.url,
                            function() {
                                require([that.requireName], function(myinstance) {
                                    that.instance = myinstance;
                                    console.log(that.id + " instantiated. instance:", that.instance);
                                    that.instance.init();
                                    if (callback) callback();
                                });
                            }
                        );
                    }
                    $(window).trigger('resize');
                },
                hide: function() {
                    this.div.addClass("hidden");
                    this.btn.removeClass("active");
                    if (this.instance != null) {
                        this.instance.unactivateWidget();
                    }
                    $(window).trigger('resize');
                },
                }
            }();
            this.shuttlexpressObj.init();
            //End ShuttleXpress

            // Touch Plate
            // Dynamically load the Touch Plate widget, i.e. wait til user clicks on 
            // the button first time.
            this.touchPlateObj = function() {
                return {
                touchPlateBtn: null,
                touchPlateDiv: null,
                touchPlateInstance: null,
                init: function() {
                    this.touchPlateBtn = $('#com-chilipeppr-ws-menu .touchplate-button');
                    this.touchPlateDiv = $('#com-chilipeppr-ws-touchplate');
                    this.setupBtn();
                    console.log("done instantiating touchPlate add-on widget");
                },
                setupBtn: function() {
                    this.touchPlateBtn.click(this.toggletouchPlate.bind(this));
                },
                toggletouchPlate: function() {
                    if (this.touchPlateDiv.hasClass("hidden")) {
                        // unhide
                        this.showtouchPlate();
                    }
                    else {
                        this.hidetouchPlate();
                    }
                },
                showtouchPlate: function(callback) {
                    this.touchPlateDiv.removeClass("hidden");
                    this.touchPlateBtn.addClass("active");

                    // see if instantiated already
                    // if so, just activate
                    if (this.touchPlateInstance != null) {
                        this.touchPlateInstance.activateWidget();
                        if (callback) callback();
                    }
                    else {
                        // otherwise, dynamic load
                        var that = this;
                        chilipeppr.load(
                            "#com-chilipeppr-ws-touchplate",
                            "widgets/widget-touchplate/auto-generated-widget.html",
                            function() {
                                require(["inline:com-chilipeppr-widget-touchplate"], function(touchPlate) {
                                    that.touchPlateInstance = touchPlate;
                                    console.log("touchPlate instantiated. touchPlateInstance:", that.touchPlateInstance);
                                    that.touchPlateInstance.init();
                                    //eagleInstance.activateWidget();
                                    if (callback) callback();
                                });
                            }
                        );
                    }
                    $(window).trigger('resize');
                },
                hidetouchPlate: function() {
                    this.touchPlateDiv.addClass("hidden");
                    this.touchPlateBtn.removeClass("active");
                    if (this.touchPlateInstance != null) {
                        this.touchPlateInstance.unactivateWidget();
                    }
                    $(window).trigger('resize');
                },
                }
            }();
            this.touchPlateObj.init();
            //End Touch Plate

            // Super Touch Plate
            // http://raw.githubusercontent.com/PyroAVR/widget-super-touchplate/master/auto-generated-widget.html
            // Dynamically load, i.e. wait til user clicks on the button first time.
            this.superTouchPlateObj = function() {
                return {
                superTouchPlateBtn: null,
                superTouchPlateDiv: null,
                superTouchPlateInstance: null,
                init: function() {
                    this.superTouchPlateBtn = $('#com-chilipeppr-ws-menu .superTouchplate-button');
                    this.superTouchPlateDiv = $('#com-chilipeppr-ws-superTouchplate');
                    this.setupBtn();
                    console.log("done instantiating superTouchPlate add-on widget");
                },
                setupBtn: function() {
                    this.superTouchPlateBtn.click(this.togglesuperTouchPlate.bind(this));
                },
                togglesuperTouchPlate: function() {
                    if (this.superTouchPlateDiv.hasClass("hidden")) {
                        // unhide
                        this.showsuperTouchPlate();
                    }
                    else {
                        this.hidesuperTouchPlate();
                    }
                },
                showsuperTouchPlate: function(callback) {
                    this.superTouchPlateDiv.removeClass("hidden");
                    this.superTouchPlateBtn.addClass("active");

                    // see if instantiated already
                    // if so, just activate
                    if (this.superTouchPlateInstance != null) {
                        this.superTouchPlateInstance.activateWidget();
                        if (callback) callback();
                    }
                    else {
                        // otherwise, dynamic load
                        var that = this;
                        chilipeppr.load(
                            "#com-chilipeppr-ws-superTouchplate",
                            "widgets/widget-super-touchplate/auto-generated-widget.html",
                            function() {
                                require(["inline:com-chilipeppr-widget-super-touchplate"], function(superTouchPlate) {
                                    that.superTouchPlateInstance = superTouchPlate;
                                    console.log("superTouchPlate instantiated. superTouchPlateInstance:", that.superTouchPlateInstance);
                                    that.superTouchPlateInstance.init();
                                    //eagleInstance.activateWidget();
                                    if (callback) callback();
                                });
                            }
                        );
                    }
                    $(window).trigger('resize');
                },
                hidesuperTouchPlate: function() {
                    this.superTouchPlateDiv.addClass("hidden");
                    this.superTouchPlateBtn.removeClass("active");
                    if (this.superTouchPlateInstance != null) {
                        this.superTouchPlateInstance.unactivateWidget();
                    }
                    $(window).trigger('resize');
                },
                }
            }();
            this.superTouchPlateObj.init();
            //End Super Touch Plate
            
            // Arduino / Atmel Firmware Programmer
            // FIDDLE http://jsfiddle.net/chilipeppr/qcduvhkh/11/
            chilipeppr.load(
                "com-chilipeppr-ws-programmer",
                "widgets/widget-programmer/auto-generated-widget.html",
                require(["inline:com-chilipeppr-widget-programmer"], function (programmer) {
                    programmer.init();
                    // setup toggle button
                    var btn = $('#com-chilipeppr-ws-menu .programmer-button');
                    var div = $('#com-chilipeppr-ws-programmer');
                    btn.click(programmer.show.bind(programmer));
                })  
            );  //End Arduino / Atmel Firmware Programmer
    
            // Element / Drag Drop
            // Load the dragdrop element into workspace toolbar
            // http://jsfiddle.net/chilipeppr/Z9F6G/
            chilipeppr.load("#com-chilipeppr-ws-gcode-dragdrop",
                "widgets/elem-dragdrop/auto-generated-widget.html",
                function() {
                    require(["inline:com-chilipeppr-elem-dragdrop"], function(dd) {
                        console.log("inside require of dragdrop");
                        $('.com-chilipeppr-elem-dragdrop').removeClass('well');
                        dd.init();
                        // The Chilipeppr drag drop element will publish
                        // on channel /com-chilipeppr-elem-dragdrop/ondropped
                        // when a file is dropped so subscribe to it
                        // It also adds a hover class to the bound DOM elem
                        // so you can add CSS to hilite on hover
                        dd.bind("#com-chilipeppr-ws-gcode-wrapper", null);
                        //$(".com-chilipeppr-elem-dragdrop").popover('show');
                        //dd.bind("#pnlWorkspace", null);
                        var ddoverlay = $('#com-chilipeppr-ws-gcode-dragdropoverlay');
                        chilipeppr.subscribe("/com-chilipeppr-elem-dragdrop/ondragover", function() {
                            //console.log("got dragdrop hover");
                            ddoverlay.removeClass("hidden");
                        });
                        chilipeppr.subscribe("/com-chilipeppr-elem-dragdrop/ondragleave", function() {
                            ddoverlay.addClass("hidden");
                            //console.log("got dragdrop leave");
                        });
                        console.log(dd);
                    });
                }
            ); //End Element / Drag Drop
            
            // 3D Viewer
            chilipeppr.load(
                "#com-chilipeppr-3dviewer",
                "widgets/xpix-widget-3dviewer/auto-generated-widget.html",
    
                function() {
                    console.log("got callback done loading 3d");
    
                    cprequire(
                        ['inline:com-chilipeppr-widget-3dviewer'],
    
                        function(threed) {
                            console.log("Running 3dviewer");
                            threed.init();
                            console.log("3d viewer initted");
    
                            // Ok, do someting whacky. Try to move the 3D Viewer 
                            // Control Panel to the center column
                            setTimeout(function() {
                                var element = $('#com-chilipeppr-3dviewer .panel-heading').detach();
                                $('#com-chilipeppr-3dviewer').addClass("noheight");
                                $('#com-chilipeppr-widget-3dviewer').addClass("nomargin");
                                $('#com-chilipeppr-3dviewer-controlpanel').append(element);
                            }, 10);
    
                            // listen to resize events so we can resize our 3d viewer
                            // this was done to solve the scrollbar residue we were seeing
                            // resize this console on a browser resize
                            var mytimeout = null;
                            $(window).on('resize', function(evt) {
                                //console.log("3d view force resize");
                                if (mytimeout !== undefined && mytimeout != null) {
                                    clearTimeout(mytimeout);
                                    //console.log("cancelling timeout resize");
                                }
                                mytimeout = setTimeout(function() {
                                    console.log("3d view force resize. 1 sec later");
                                    threed.resize();
                                }, 1000);
    
                            });
                        }
                    );
                }
            ); //End 3D Viewer

            // Gcode List v3
            chilipeppr.load("#com-chilipeppr-gcode-list",
                "widgets/xpix-widget-gcodelist/auto-generated-widget.html",

                function() {
                    cprequire(
                        ["inline:com-chilipeppr-widget-gcode"],

                        function(gcodelist) {
                            gcodelist.init({
                                lineNumbersOnByDefault: true
                            });
                        }
                    );
                }
            ); //End Gcode List v3

            // Serial Port Console Log Window
            // http://jsfiddle.net/chilipeppr/JB2X7/
            // NEW VERSION http://jsfiddle.net/chilipeppr/rczajbx0/
            // The new version supports onQueue, onWrite, onComplete
            chilipeppr.load("#com-chilipeppr-serialport-log",
                "widgets/xpix-widget-console/auto-generated-widget.html",

                function() {
                    cprequire(
                        ["inline:com-chilipeppr-widget-spconsole"],

                        function(spc) {
                            // pass in regular expression filter as 2nd parameter
                            // to enable filter button and clean up how much
                            // data is shown
                            spc.init(true, /^{/);

                            // resize this console on a browser resize
                            $(window).on('resize', function(evt) {
                                //console.log("serial-port-console. resize evt:", evt);
                                if ($.isWindow(evt.target)) {
                                    //console.log("resize was window. so resizing");
                                    spc.resize();
                                }
                                else {
                                    //console.log("resize was not window, so ignoring");
                                }
                            });
                            // resize this console if we get a publish
                            // from the gcode viewer widget
                            chilipeppr.subscribe("/com-chilipeppr-widget-gcode/resize", spc, spc.resize);

                        }
                    );
                }
            ); //End Serial Port Console Log Window


            // XYZ
            chilipeppr.load(
                "com-chilipeppr-xyz",
                "widgets/widget-axes/auto-generated-widget.html", 
                function () {
                    cprequire(
                    ["inline:com-chilipeppr-widget-xyz"],
            
                    function (xyz) {
                        xyz.init();
                    });
                }
            ); //End XYZ
            
            // TinyG
            chilipeppr.load(
                "com-chilipeppr-tinyg",
                "widgets/xpix-widget-tinyg/auto-generated-widget.html",
        
                function () {
                    cprequire(
                    ["inline:com-chilipeppr-widget-tinyg"],
            
                    function (tinyg) {
                        tinyg.init();
                    });
                }
            ); //End TinyG

            // Cayenn Widget
            chilipeppr.load(
              "#com-chilipeppr-ws-cayenn",
              "widgets/widget-cayenn/auto-generated-widget.html",
              function() {
                // Callback after widget loaded into #myDivWidgetCayenn
                // Now use require.js to get reference to instantiated widget
                cprequire(
                  ["inline:com-chilipeppr-widget-cayenn"], // the id you gave your widget
                  function(myObjWidgetCayenn) {
                    // Callback that is passed reference to the newly loaded widget
                    console.log("Widget / Cayenn just got loaded.", myObjWidgetCayenn);
                    myObjWidgetCayenn.init();
                    
                    // this widget has a lot of modals that pop up whenever, so we need to make sure the parent div is
                    // not hidden. instead we'll hide the exact widget because the modals are outside the div of the widget
                    $('#com-chilipeppr-ws-cayenn').removeClass("hidden");
                    
                    var btn = $('#com-chilipeppr-ws-menu .cayenn-button');
                    var div = $('#com-chilipeppr-widget-cayenn');
                    div.addClass("hidden");
                    btn.click(function() {
                        if (div.hasClass("hidden")) {
                            // show widget
                            div.removeClass("hidden");
                            btn.addClass("active");
                        } else {
                            // hide widget
                            div.addClass("hidden");
                            btn.removeClass("active");
                        }
                        setTimeout(function() {
                            $(window).trigger('resize');
                        }, 200);
                    });
                    
                  }
                );
              }
            );
        },
        //end loadWidgets

    }
});
    //]]>
    </script>

</head>

<body>

    <div id="com-chilipeppr-widget-flash-instance"></div>
    <!--not sure which version to keep-->

    <div id="com-chilipeppr-workspace-tinyg" class="xhidden">
        <div id="com-chilipeppr-ws-gcode-wrapper" class="dropArea">
            <div id="com-chilipeppr-ws-gcode-dragdropoverlay" class="hidden">
                <div class="well">Drag and Drop Gcode Files Onto Browser Window</div>
            </div>
            <div class="container-fluid">
                <div class="row">
                    <div class="col-xs-3 widgetx padrt">
                        <!-- 3D Viewer. Must be loaded at top to get z-orders correct -->
                        <div id="com-chilipeppr-3dviewer">Load 3D Viewport Here</div>
                        <!-- Workspace Hdr -->
                        <div id="com-chilipeppr-ws-gcode-hdr" class="com-chilipeppr-ws-hdr zhigh well">
                            
                            <span class="workspace-title">Workspace TinyG</span>
                            
                            <div id="com-chilipeppr-ws-menu" class="">
                                
                                <div class="pull-right">
                                    <div class="dropdown">
                                        <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
                                        <ul class="dropdown-menu dropdown-menu-ws" role="menu">
                                            <li class="com-chilipeppr-ws-menu-billboard" style="width:350px;">
                                                <!-- Billboard -->
                                                <div class="com-chilipeppr-ws-billboard">
                                                </div>
                                                <!-- End Billboard -->
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div id="com-chilipeppr-ws-gcode-dragdrop" xstyle="margin-right:6px;" class="pull-left"></div>
                                
                                <div class="dropdown pull-left">
                                  <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                    Widgets
                                    <span class="caret"></span>
                                  </button>
                                  <ul class="dropdown-menu workspace-dropdown" aria-labelledby="dropdownMenu1">
                                    <!--<li><a href="#">Action</a></li>-->
                                    <!--<li><a href="#">Another action</a></li>-->
                                    <!--<li><a href="#">Something else here</a></li>-->
                                    <!--<li role="separator" class="divider"></li>-->
                                    <!--<li><a href="#">Separated link</a></li>-->
                                    
                                    <li><button type="button" class="btn-ws btn btn-xs btn-default zipwhip-button" data-container="body" data-toggle="popover" data-placement="auto" data-content="Get a text sent to you when your CNC job is completed." data-trigger="hover" data-delay="100"><span class="zipwhip"></span>Send Text on Job Done</button></li>
                                    <li><button type="button" class="btn-ws btn btn-xs btn-default zipwhip-recvtext-button" data-container="body" data-toggle="popover" data-placement="auto" data-content="Login to Zipwhip to receive texts and start a CNC job when the text is received." data-trigger="hover" data-delay="100"><span class="zipwhip"></span>Recv Text to Trigger</button></li>
                                    <li><button type="button" class="btn-ws btn btn-xs btn-default autolevel-button" data-container="body" data-toggle="popover" data-placement="auto" data-content="Allows you to auto-level your PCB before milling. Most raw PCB boards have a slight warpage. This widget lets you probe the warpage and then it auto-scales your Gcode to match the warpage so you get very clean/predictable z-positions in your milling job."
                                    data-trigger="hover" data-delay="100">Auto-Level</button></li>
                                    <li><button type="button" class="btn-ws btn btn-xs btn-default macro-button" data-container="body" data-toggle="popover" data-placement="auto" data-content="Run a macro." data-trigger="hover" data-delay="100">Macro</button></li>
                                    <li><button type="button" class="btn-ws btn btn-xs btn-default jscut-button" data-container="body" data-toggle="popover" data-placement="auto" data-content="Load file from JSCut" data-trigger="hover" data-delay="100">JScut</button></li>
                                    <!--<li><button type="button" class="btn-ws btn btn-xs btn-default lasersolder-button" data-container="body" data-toggle="popover" data-placement="auto" data-content="Laser Solderer" data-trigger="hover" data-delay="100">Laser Solder</button></li>-->
                                    <li><button type="button" class="btn-ws btn btn-xs btn-default eagle-button" data-container="body" data-toggle="popover" data-placement="auto" xdata-content="Laser Solderer" data-trigger="hover" data-delay="100">Eagle BRD Import</button></li>
                                    <li><button type="button" class="btn-ws btn btn-xs btn-default gpio-button" data-container="body" data-toggle="popover" data-placement="auto" data-content="GPIO Server by Ben Delarre. Allows you to control your GPIO ports on a Raspberry Pi or Beagle Bone Black to toggle on/off hardware components. For example, you could toggle a fan on/off via GPIO."
                                    data-trigger="hover" data-delay="100">GPIO</button></li>
                                    <li><button type="button" class="btn-ws btn btn-xs btn-default shuttlexpress-button" data-container="body" data-toggle="popover" data-placement="auto" data-content="ShuttleXpress Jog Dial." data-trigger="hover" data-delay="100">ShuttleXpress</button></li>
    
                                    <li><button type="button" class="btn-ws btn btn-xs btn-default touchplate-button" data-container="body" data-toggle="popover" data-placement="auto" data-content="Use a touch plate to easily figure out your Z zero of your workpiece and set it." data-trigger="hover"
                                    data-delay="100">Touch Plate</button></li>
                                    <li><button type="button" class="btn-ws btn btn-xs btn-default superTouchplate-button" data-container="body" data-toggle="popover" data-placement="auto" data-content="XYZ touch plate. Use a touch plate to figure out your X zero, Y zero, and Z zero of your workpiece." data-trigger="hover"
                                    data-delay="100">Super Touch Plate</button></li>
    
                                    <li><button type="button" class="btn-ws btn btn-xs btn-default programmer-button" data-container="body" data-toggle="popover" data-placement="auto" data-content="Program your Arduino or Atmel chip directly from ChiliPeppr." data-trigger="hover" data-delay="100">Arduino / Atmel Firmware Uploader</button></li>
                                    <li><button type="button" class="btn-ws btn btn-xs btn-default svg2gcode-button" data-container="body" data-toggle="popover" data-placement="auto" data-content="Import an SVG file to Gcode" data-trigger="hover" data-delay="100">SVG Import</button></li>
                                    <li><button type="button" class="btn-ws btn btn-xs btn-default font2gcode-button" data-container="body" data-toggle="popover" data-placement="auto" data-content="Create Gcode from text" data-trigger="hover" data-delay="100">Font2Gcode</button></li>
                                
                                    <li><button type="button" class="btn-ws btn btn-xs btn-default cayenn-button" data-container="body" data-toggle="popover" data-placement="auto" data-content="View your Cayenn devices" data-trigger="hover" data-delay="100">Cayenn Devices</button></li>
                                
                                  </ul>
                                </div>
                                
                            </div>

                        </div>
                        
                        <!-- SVG2Gcode -->
                        <div class="zhigh hidden" id="com-chilipeppr-ws-cayenn"></div>
                        
                        <!-- SVG2Gcode -->
                        <div class="zhigh hidden" id="com-chilipeppr-ws-svg2gcode"></div>

                        <!-- Font2Gcode -->
                        <div class="zhigh hidden" id="com-chilipeppr-ws-font2gcode"></div>
                        
                        <!-- Zipwhip Text Messaging -->
                        <div class="zhigh hidden" id="com-chilipeppr-ws-zipwhip"></div>
                        
                        <!-- Zipwhip Text Messaging Receive Text widget -->
                        <div class="zhigh hidden" id="com-chilipeppr-ws-zipwhip-recvtext"></div>

                        <!-- Auto Leveller -->
                        <div class="zhigh hidden" id="com-chilipeppr-ws-autolevel">Auto-Level Here</div>

                        <!-- Macro -->
                        <div class="zhigh hidden" id="com-chilipeppr-ws-macro">Macro Here</div>

                        <!-- JScut -->
                        <div class="zhigh hidden" id="com-chilipeppr-ws-jscut">Jscut Here</div>

                        <!-- Laser Solder -->
                        <div class="zhigh hidden" id="com-chilipeppr-ws-lasersolder">Laser Solderer Here</div>

                        <!-- Eagle BRD -->
                        <div class="zhigh hidden" id="com-chilipeppr-ws-eagle">Eagle BRD Here</div>

                        <!-- GPIO -->
                        <div class="zhigh hidden" id="com-chilipeppr-ws-gpio">GPIO Here</div>

                        <!-- shuttlexpress -->
                        <div class="zhigh hidden" id="com-chilipeppr-ws-shuttlexpress">ShuttleXpress Here</div>

                        <!-- Touch Plate -->
                        <div class="zhigh hidden" id="com-chilipeppr-ws-touchplate">Touch Plate Here</div>
                        
                        <!-- Super Touch Plate -->
                        <div class="zhigh hidden" id="com-chilipeppr-ws-superTouchplate">Super Touch Plate Here</div>

                        <!-- Arduino / Atmel Firmware Programmer -->
                        <div class="zhigh xhidden" id="com-chilipeppr-ws-programmer">Arduino / Atmel Firmware Programmer Here</div>

                        <!-- Gcode List -->
                        <div id="com-chilipeppr-gcode-list" class="zhigh">Load Gcode List Here</div>
                        <!-- Serial In/Out Text Log-->
                        <div id="com-chilipeppr-widget-console-instance" class="zhigh">Load Serial Port Console Here</div>
                    </div>
                    <!-- 3D Viewer -->
                    <div class="widget col-xs-6">
                        <div class="">
                            <table><tr><td>
                                <div id="com-chilipeppr-3dviewer-controlpanel" style=""></div>
                            </td></tr>
                            <tr><td>
                                <div id="com-chilipeppr-ws-rpmsensor" style="padding: 10px 10px;" class="hidden"></div>
                            </td></tr>
                            </table>
                        </div>
                        
                    </div>
                    <div class="col-xs-3 nopadding">
                        <!-- XYZ -->
                        <div id="com-chilipeppr-xyz" class="">Load XYZ Here</div>
                        <!-- Tinyg -->
                        <div id="com-chilipeppr-tinyg" class="">Load TinyG Here</div>
                        <!-- WebRTC Client -->
                        <div id="com-chilipeppr-webrtcclient" class="hidden">Load WebRTC Client Here</div>
                        <!-- Serial Port Selector -->
                        <div id="com-chilipeppr-widget-spjs-instance" class="">Load Serial Port Selector Here</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Keep this div hidden so it can be cloned and used by the Javascript -->
    <div id="com-chilipeppr-workspace-tinyg-billboard" class="hidden">
        <div class="billboard-content">
            <h4 class="billboard-title" style="">TinyG Workspace</h4>

            <p class="billboard-url" style=""><a href="http://chilipeppr.com/tinyg">chilipeppr.com/tinyg</a>

            </p>
            <div class="billboard-imgcontain" style="">
                <a href="http://chilipeppr.com/tinyg">
                    <div class="billboard-img" style="background-image: url('https://i2dcui.appspot.com/img/tinyg.jpg')" />
                </a>
                <div class="billboard-stats2">
                </div>

            </div>
            <p class="billboard-desc">
                A ChiliPeppr Workspace for TinyG CNC controllers.
            </p>
        </div>
    </div>

</body>

</html>
